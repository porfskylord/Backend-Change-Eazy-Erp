<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BACKEND CHANGE</title>
    <style>
     /* General Styles */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e1e1e, #121212);
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Main Content Container */
        .content {
            max-width: 1200px;
            width: 100%;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .content:hover {
            transform: translateY(-5px);
        }

        /* Headings */
        h1 {
            color: #ffffff;
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Cards */
        .card {
            background: rgba(44, 44, 44, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);

        }

        /* Form Styles */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-weight: 500;
            color: #ffffff;
            display: block;
			margin: 10px 0 5px;
			font-family: 'Arial', sans-serif;
			font-size: 16px;
        }

        /* Input & Select Fields */
        select, input[type="text"] {
            padding: 12px;
            width: calc(100% - 20px); /* Full width minus padding and border */
			padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            margin-bottom: 15px;

        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #bb86fc;
            background: rgba(255, 255, 255, 0.2);
        }

        select {
            width: calc(100% - 0px);

        }

        input{
            width: calc(100% - 20px);

        }
        /* Buttons */
        button {
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            background: linear-gradient(135deg, #bb86fc, #7564ff);
            color: #ffffff;
            transition: all 0.3s ease;  
            margin-top: 15px;      
            margin-bottom: 15px;    
        }



        button:hover {
            background: linear-gradient(135deg, #a370f0, #5a4bda);
            transform: scale(1.05);
        }

        button:active {
            background: linear-gradient(135deg, #8e5be0, #4a3dbf);
            transform: scale(0.98);
        }

        /* Query Output */
        #queryOutput {
            background: rgba(44, 44, 44, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        #queryText {
            background: rgba(30, 30, 30, 0.9);
            padding: 12px;
            border-radius: 8px;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Button Container */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        #autocopelabel {
            color: greenyellow;
            margin: 10px 0 5px;
			font-family: 'Arial', sans-serif;
			font-size: 11px;
			
        }

        option {
			background: #2A2A2A; /* Dark background */
			color: #E0E0E0; /* White text */
			padding: 12px;
		}



        /* Responsive Design */
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .card {
                padding: 18px;
            }

            select, input[type="text"], button {
                font-size: 14px;
            }
        }

    </style>
</head>
<body>
    <div class="content">
        <div id="backchcontent" class="backchcontent active">
            <h1>BACKEND CHANGE QUERY GENERATED</h1>
            <div class="card">
                <div >
                    <button type="button" id="mainformbtn" onclick="gobackbt()">GO Back</button>
                </div>
                <form id="mainForm" action="#" method="post">
                    <label for="options">Choose an option:</label>
                    <select id="options" name="options" onchange="handleFormDisplay()">
                        <option value="none">Please select</option>
                        <option value="cancel_stock_transfer">Cancel Production and Stock transfer Query</option>
                        <option value="tallysync">Tallysync Query</option>
                        <option value="authorization_query">Authorize/Unauthorize Query</option>
                    </select>

                </form>
    
                <form id="cancelForm" action="#" method="post" style="display: none;">
                    <h1>Cancel Production and Stock Transfer</h1>
                    <label for="transactionType">Transaction Type:</label>
                    <select id="transactionType" name="transactionType">
                        <option value="production">Production</option>
                        <option value="stock">Stock</option>
                    </select>
    
                    <label for="transactionNo">Transaction No:</label>
                    <input type="text" id="transactionNo" name="transactionNo" required>
    
                    <label for="transactionDate">Transaction Date:</label>
                    <input type="text" id="transactionDate" name="transactionDate" required>
    
                    <button type="button" id="generateCancelQueryButton" onclick="cancelquery()">Generate Query</button>
                </form>
    
                <form id="tallysyncForm" action="#" method="post" style="display: none;">
                    <h1>Tallysync</h1>
                    <div class="button-container">
                        <button type="button" id="singleTransactionButton" onclick="singleTransaction()">Single Transaction</button>
                        <button type="button" id="multipleTransactionButton" onclick="multipleTransaction()">Multiple Transactions</button>
                    </div>
    
                    <div id="singleTransactionForm" style="display: none;">
                        <label for="tableName">Table Name:</label>
                        <select id="tableName" name="tableName">
                            <option value="sale_salesinvoice">Sales Invoice</option>
                            <option value="pur_purchaseinvoice">Purchase Invoice</option>
                            <option value="pur_purchaseorder">Purchase Order</option>
                            <option value="sale_salesorder">Sales Order</option>
                        </select>
    
                        <label for="transactionNoTally">Transaction No:</label>
                        <input type="text" id="transactionNoTally" name="transactionNoTally" required>
    
                        <label for="transactionDateTally">Transaction Date:</label>
                        <input type="text" id="transactionDateTally" name="transactionDateTally" required>
    
                        <button type="button" id="generateTallyQueryButton" onclick="singletallyquery()">Generate Query</button>
                    </div>
    
                    <div id="multipleTransactionForm" style="display: none;">
                        <label for="tableNameMultiple">Table Name:</label>
                        <select id="tableNameMultiple" name="tableNameMultiple">
                            <option value="sale_salesinvoice">Sales Invoice</option>
                            <option value="pur_purchaseinvoice">Purchase Invoice</option>
                            <option value="pur_purchaseorder">Purchase Order</option>
                            <option value="sale_salesorder">Sales Order</option>
                        </select>
    
                        <label for="transactionNos">Transaction Nos (comma-separated):</label>
                        <input type="text" id="transactionNos" name="transactionNos" required>
    
                        <button type="button" id="generateMultipleTallyQueryButton" onclick="multipletallyquery()">Generate Query</button>
                    </div>
                </form>
    
                <form id="authorizationQueryForm" action="#" method="post" style="display: none;">
                    <h1>Authorization Query</h1>
                    <label for="authQueryTable">Table Name:</label>
                    <select id="authQueryTable" name="authQueryTable">
                        <option value="sale_salesinvoice">Sales Invoice</option>
                        <option value="pur_purchaseinvoice">Purchase Invoice</option>
                        <option value="pur_purchaseorder">Purchase Order</option>
                        <option value="sale_salesorder">Sales Order</option>
                        <option value="pur_inwardchallan">Inward Challan</option>
                        <option value="sale_deliverynote">Delivery Note</option>
                        <option value="pur_gateentry">Gate Entry</option>
                    </select>
    
                    <label for="authQueryNo">Transaction No:</label>
                    <input type="text" id="authQueryNo" name="authQueryNo" required>
    
                    <label for="authQueryDate">Transaction Date:</label>
                    <input type="text" id="authQueryDate" name="authQueryDate" required>
    
                    <button type="button" id="generateAuthQueryButton" onclick="authQuery()">Generate Query</button>
                </form>
    
                <div id="queryOutput" style="display: none; margin-top: 20px;">
                    <h1>Generated SQL Query</h1>
                    <pre id="queryText"></pre>
                </div>
                <label style="display: none;" id="autocopelabel">auto-copied to your clipboard✅</label>
            </div>
        </div>
    </div>

    <script>
        
        function gobackbt() {
			var mainForm = document.getElementById('mainForm');
			var cancelForm = document.getElementById('cancelForm');
			var tallysyncForm = document.getElementById('tallysyncForm');
			var authorizationQueryForm = document.getElementById('authorizationQueryForm');
            var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');
            var optionval = document.getElementById('options');
            mainForm.style.display = 'block';
			cancelForm.style.display = 'none';
			tallysyncForm.style.display = 'none';
			authorizationQueryForm.style.display = 'none';
            optionval.value = 'none';
            queryText.textContent = "";
			queryOutput.style.display = 'none';
            document.getElementById('transactionNo').value = "";
            document.getElementById('transactionDate').value = "";
            document.getElementById('transactionNoTally').value = "";
            document.getElementById('transactionDateTally').value = "";
            document.getElementById('transactionNos').value = "";
            document.getElementById('authQueryNo').value = "";
            document.getElementById('authQueryDate').value = "";


        }

        function handleFormDisplay() {
            var options = document.getElementById('options');
            var mainForm = document.getElementById('mainForm');
            var cancelForm = document.getElementById('cancelForm');
            var tallysyncForm = document.getElementById('tallysyncForm');
            var authorizationQueryForm = document.getElementById('authorizationQueryForm');

            // Show or hide forms based on selected option
            mainForm.style.display = 'none'
            cancelForm.style.display = (options.value === 'cancel_stock_transfer') ? 'block' : 'none';
            tallysyncForm.style.display = (options.value === 'tallysync') ? 'block' : 'none';
            authorizationQueryForm.style.display = (options.value === 'authorization_query') ? 'block' : 'none';
        }
        
        function cancelquery() {
            var transactionType = document.getElementById('transactionType').value;
			var transactionNo = document.getElementById('transactionNo').value;
			var transactionDate = document.getElementById('transactionDate').value;
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');
			
			// Generate SQL query based on transaction type
			if (transactionType === 'production') {
				queryText.textContent = `SELECT * FROM fun_cancellproduction((SELECT productionid from prod_productionmaster where productionno='${transactionNo}' and productiondate='${transactionDate}'),'erpadmin');`;
			} else if (transactionType === 'stock') {
				queryText.textContent = `SELECT * FROM fun_cancelstockjournal_2((select adjustmentid from stor_stockadjustmentortransfer where adjustmentno = '${transactionNo}' and adjustmentdate = '${transactionDate}'),'erpadmin');`;
			}

			// Show the generated query
			queryOutput.style.display = 'block';
            copyQuery();
        }

        function singleTransaction() {
            document.getElementById('singleTransactionForm').style.display = 'block';
			document.getElementById('multipleTransactionForm').style.display = 'none';
            document.getElementById('queryText').textContent = "";
            document.getElementById('queryOutput').style.display = 'none';
            document.getElementById('transactionNos').value = "";
        }

        function multipleTransaction() {
    
            document.getElementById('singleTransactionForm').style.display = 'none';
			document.getElementById('multipleTransactionForm').style.display = 'block';
            document.getElementById('queryText').textContent = "";
            document.getElementById('queryOutput').style.display = 'none';
            document.getElementById('transactionNoTally').value = "";
            document.getElementById('transactionDateTally').value = "";
        }

        function singletallyquery(){
            var tableName = document.getElementById('tableName').value;
			var transactionNo = document.getElementById('transactionNoTally').value;
			var transactionDate = document.getElementById('transactionDateTally').value;
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');

			var query = '';
			var currentDateTime = new Date().toLocaleString();

			// Generate SQL query based on table name
			switch (tableName) {
				case 'sale_salesinvoice':
					query = `UPDATE sale_salesinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM sale_salesinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseinvoice':
					query = `UPDATE pur_purchaseinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM pur_purchaseinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseorder':
					query = `UPDATE pur_purchaseorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE poid = (SELECT poid FROM pur_purchaseorder WHERE ponumber ='${transactionNo}' AND CAST(podate as DATE) = '${transactionDate}');`;
					break;
				case 'sale_salesorder':
					query = `UPDATE sale_salesorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE soid = (SELECT soid FROM sale_salesorder WHERE sono ='${transactionNo}' AND CAST(sodate as DATE) = '${transactionDate}');`;
					break;
			}

			// Show the generated query
			queryText.textContent = query;
			queryOutput.style.display = 'block';
            copyQuery();
        }

        function multipletallyquery(){
            var tableName = document.getElementById('tableNameMultiple').value;
			var transactionNos = document.getElementById('transactionNos').value.split(',');
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');

			var query = '';
			var currentDateTime = new Date().toLocaleString();

			// Generate SQL query based on table name
			switch (tableName) {
				case 'sale_salesinvoice':
					query = `UPDATE sale_salesinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceno IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
				case 'pur_purchaseinvoice':
					query = `UPDATE pur_purchaseinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceno IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
				case 'pur_purchaseorder':
					query = `UPDATE pur_purchaseorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE ponumber IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
				case 'sale_salesorder':
					query = `UPDATE sale_salesorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE sono IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
			}

			// Show the generated query
			queryText.textContent = query;
			queryOutput.style.display = 'block';
            copyQuery();
        }

        function authQuery(){
            var tableName = document.getElementById('authQueryTable').value;
			var transactionNo = document.getElementById('authQueryNo').value;
			var transactionDate = document.getElementById('authQueryDate').value;
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');

			var query = '';
			var currentDateTime = new Date().toLocaleString();

			// Generate SQL query based on table name
			switch (tableName) {
				case 'sale_salesinvoice':
					query = `UPDATE sale_salesinvoice SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM sale_salesinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseinvoice':
					query = `UPDATE pur_purchaseinvoice SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM pur_purchaseinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseorder':
					query = `UPDATE pur_purchaseorder SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE poid = (SELECT poid FROM pur_purchaseorder WHERE ponumber ='${transactionNo}' AND CAST(podate as DATE) = '${transactionDate}');`;
					break;
				case 'sale_salesorder':
					query = `UPDATE sale_salesorder SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE soid = (SELECT soid FROM sale_salesorder WHERE sono ='${transactionNo}' AND CAST(sodate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_inwardchallan':
					query = `UPDATE pur_inwardchallan SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE inwardchallanid = (SELECT inwardchallanid FROM pur_inwardchallan WHERE inwardchallanno ='${transactionNo}' AND CAST(inwardchallandate as DATE) = '${transactionDate}');`;
					break;
				case 'sale_deliverynote':
					query = `UPDATE sale_deliverynote SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE deliverynoteid = (SELECT deliverynoteid FROM sale_deliverynote WHERE deliverynoteno ='${transactionNo}' AND CAST(deliverynotedate as DATE) = '${transactionDate}');`;
					break;
                case 'pur_gateentry':
					query = `UPDATE pur_gateentry SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE gateentryid = (SELECT gateentryid FROM pur_gateentry WHERE entryno ='${transactionNo}' AND CAST(entrydate as DATE) = '${transactionDate}');`;
					break;
			}

			// Show the generated query
			queryText.textContent = query;
			queryOutput.style.display = 'block';
            copyQuery();
        }

        function copyQuery() {
            const queryText = document.getElementById('queryText').textContent;
            navigator.clipboard.writeText(queryText).then(() => {
                document.getElementById('autocopelabel').style.display = 'block';
            }).catch(err => {
                console.error("Error copying text: ", err);
            });
        }

        window.onload = showSaveContent;
    </script>
</body>
</html>
