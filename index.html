<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save SQL Queries</title>
    <style>
	html, body {
    	height: 100%;
    	margin: 0;
	}
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-image: url('grad.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Vertically centers the content */
            align-items: center;
        }

        #buttonContainer {
            display: flex;
            flex-direction: row;
            gap: 10px;
            padding: 15px;
            width: 97%;
            background: #8052eb;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #buttonContainer button {
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }

        #saveBtn, #viewBtn, #backchBtn {
            background-color: #9364ff;
            color: white;
        }

        #saveBtn:disabled, #viewBtn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .content {
            flex-grow: 1;
            padding: 5px;
        }
        
        h1 {
            margin-bottom: 10px;
            color: white;
            text-shadow: 2px 4px 4px rgb(46 91 173 / 0.6);
        }

        .form-container {
            width: 1200px;
            background: white;
            padding: 20px;
            height:100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .form-container label {
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 2px 8px 8px rgb(0, 0, 0, 0.1);
            display: block;
        }

        .form-container input, .form-container textarea {
            width: 97%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .form-container button {
            padding: 10px 20px;
            background-color: #9364ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }

        .form-container button:hover {
            background-color: #8052eb;
        }

        #sqlQuery {
            height: 120px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            display: none; /* Initially hide the entire table, including header */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: top;
            word-break: break-word;
            height: 50px; /* Fixed row height */
        }

        th {
            background-color: #8052eb;
            color: white;
            text-align: center;
        }

        #savecontent, #viewcontent, #backchcontent{
            width:100%;
        }
        .savecontent, .viewcontent, .backchcontent{
            display: none;
        }

        .active {
            display: block;
        }

        #tasknm, #datanm, #uplnm, #datenm {
            width: 100px;
        }

        /* Loader Styles */
        #loader {
            width: 100%;
            text-align: center;
            margin-top: 20px;
            display: block;
        }

        .loader-bar {
            width: 80%;
            height: 10px;
            background-color: #ddd;
            margin: 10px auto;
            border-radius: 5px;
            overflow: hidden;
        }

        .loader-progress {
            width: 0%;
            height: 100%;
            background-color: #8052eb;
            border-radius: 5px;
            transition: width 0.3s;
        }
		
		/* View Container Styles */
        #viewContainer {
            display: flex;
			width: 97%;
            flex-direction: row;
            gap: 15px;
            margin-bottom: 20px;
			justify-content: center; /* Vertically centers the content */
            align-items: center;
        }

        #viewContainer label {
            padding: 10px;
			 width:100px;
            font-weight: bold;
			color: white;
            text-shadow: 2px 4px 4px rgb(46 91 173 / 0.6);
        }

        #viewContainer input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        
        }

        #viewContainer button {
           padding: 10px 10px;
		   width:200px;
            background-color: #9364ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }
		.backchcontent .card {
			width: 1200px;
			margin: 5% auto; /* Center with 5% margin from top and bottom */
			padding: 20px;
			border-radius: 10px;
			background: white;
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
			position: relative;
		}

		/* Style the headers in the card */
		.backchcontent .card h1 {
			margin-top: 0;
			font-family: 'Arial', sans-serif; /* Change this to your preferred font */
			font-size: 24px;
			color: #333;
			text-align: center;
		}

		/* Style for the form elements */
		.backchcontent form {
			margin: 0;
			padding: 0;
		}

		/* Style for form labels and inputs */
		.backchcontent label {
			display: block;
			margin: 10px 0 5px;
			font-family: 'Arial', sans-serif;
			font-size: 16px;
			color: #555;
		}

		/* Common style for text inputs and select dropdown */
		.backchcontent input[type="text"], select {
			width: calc(100% - 0px); /* Full width minus padding and border */
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 5px;
			font-size: 16px;
			margin-bottom: 15px;
			box-sizing: border-box;
		}

		/* Dropdown-specific styling */
		.backchcontent select {
			background-color: #fff; /* White background for dropdown */
			cursor: pointer; /* Pointer cursor for dropdown */
		}

		/* Style dropdown options */
		.backchcontent select option {
			padding: 10px; /* Add padding to dropdown options */
		}

		/* Dropdown hover style */
		.backchcontent select:hover {
			border-color: #7564ff; /* Color on hover */
			background-color: #f0f8ff; /* Light background on hover */
		}

		/* Style for buttons */
		.backchcontent button {
			padding: 10px 15px;
			border: none;
			border-radius: 5px;
			background-color: #7564ff; /* Light purple color */
			color: white;
			font-size: 16px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.backchcontent button:hover {
			background-color: #5a43d4; /* Slightly darker purple for hover effect */
		}

		/* Style for generated SQL query card */
		.backchcontent #queryOutput {
			padding: 15px;
			border-radius: 10px;
			background: #f9f9f9;
			border: 1px solid #ddd;
		}

		/* Style the SQL query text */
		.backchcontent #queryText {
			white-space: pre-wrap; /* Preserve whitespace and formatting */
			font-family: monospace;
			color: #333;
		}		
    </style>
</head>
<body>
    <div id="buttonContainer">
        <button id="saveBtn" onclick="showSaveContent()">Save Query</button>
        <button id="viewBtn" onclick="showViewContent()">View Queries</button>
		<button id="backchBtn" onclick="showBackchContent()">Backend Changes</button>
    </div>

    <div class="content">
        <!-- Save Query Form -->
        <div id="savecontent" class="savecontent active">
            <h1>Save SQL Query</h1>
            <div class="form-container">
                <form id="queryForm">
                    <label for="taskName">Task Name</label>
                    <input type="text" id="taskName" placeholder="Task Name" required>
                    <label for="dbName">Database Name</label>
                    <input type="text" id="dbName" placeholder="Database Name" required>
                    <label for="sqlQuery">SQL Query</label>
                    <textarea id="sqlQuery" placeholder="Enter your SQL Query here..." required></textarea>
                    <div class="checkbox-container">
                        <label for="uploaded">Uploaded?</label>
                        <input type="checkbox" id="uploaded">
                    </div>
                    <button type="button" onclick="saveQuery()">Save Query</button>
                </form>
            </div>
        </div>

        <!-- View Queries Section -->
        <div id="viewcontent" class="viewcontent active">
            <h1>Saved SQL Queries</h1>
			            <!-- View Container for Filter -->
            <div id="viewContainer">
                <label for="taskFilter">Filter Task</label>
                <input type="text" id="taskFilter" placeholder="Enter task name to filter">
                <button type="button" onclick="filterTasks()">Filter</button>
            </div>
			
            <div class="form-container">
                <!-- Loader -->
                <div id="loader">
                    <div class="loader-bar">
                        <div class="loader-progress" id="loaderProgress"></div>
                    </div>
                    <p>Loading queries...</p>
                </div>
                <!-- Table (Initially hidden) -->
                <table id="queryTable">
                    <thead>
                        <tr>
                            <th id="tasknm">Task Name</th>
                            <th id="datanm">Database Name</th>
                            <th id="sqlhm">SQL Query</th>
                            <th id="uplnm">Uploaded</th>
                            <th id="datenm">Date</th>
                        </tr>
                    </thead>
                    <tbody id="queryTableBody">
                        <!-- Data will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
		
		
		<div  id="backchcontent" class="backchcontent active">
		<h1>BACKEND CHANGE QUERY GENERATED</h1>
		<div class="card">
		<button type="button" id="mainformbtn">GO Back</button>
        <!-- Main form with dropdown to choose an option -->
        <form id="mainForm" action="#" method="post">
            <label for="options">Choose an option:</label>
            <select id="options" name="options">
                <option value="none">Please select</option>
                <option value="cancel_stock_transfer">Cancel Production and Stock transfer Query</option>
                <option value="tallysync">Tallysync Query</option>
                <option value="authorization_query">Authorize/Unauthorize Query</option>
            </select>
            <button type="submit">Submit</button>
        </form>

        <!-- Form for Cancel Production and Stock Transfer -->
        <form id="cancelForm" action="#" method="post" style="display: none;">
            <h1>Cancel Production and Stock Transfer</h1>
            <label for="transactionType">Transaction Type:</label>
            <select id="transactionType" name="transactionType">
                <option value="production">Production</option>
                <option value="stock">Stock</option>
            </select>

            <label for="transactionNo">Transaction No:</label>
            <input type="text" id="transactionNo" name="transactionNo" required>

            <label for="transactionDate">Transaction Date:</label>
            <input type="text" id="transactionDate" name="transactionDate" required>

            <button type="button" id="generateCancelQueryButton">Generate Query</button>
        </form>

        <!-- Form for Tallysync with options for Single or Multiple Transactions -->
        <form id="tallysyncForm" action="#" method="post" style="display: none;">
            <h1>Tallysync</h1>
            <button type="button" id="singleTransactionButton">Single Transaction</button>
            <button type="button" id="multipleTransactionButton">Multiple Transactions</button>
            
            <!-- Single Transaction Form -->
            <div id="singleTransactionForm" style="display: none;">
                <label for="tableName">Table Name:</label>
                <select id="tableName" name="tableName">
                    <option value="sale_salesinvoice">Sales Invoice</option>
                    <option value="pur_purchaseinvoice">Purchase Invoice</option>
                    <option value="pur_purchaseorder">Purchase Order</option>
                    <option value="sale_salesorder">Sales Order</option>
                </select>

                <label for="transactionNoTally">Transaction No:</label>
                <input type="text" id="transactionNoTally" name="transactionNoTally" required>

                <label for="transactionDateTally">Transaction Date:</label>
                <input type="text" id="transactionDateTally" name="transactionDateTally" required>

                <button type="button" id="generateTallyQueryButton">Generate Query</button>
            </div>

            <!-- Multiple Transactions Form -->
            <div id="multipleTransactionForm" style="display: none;">
                <label for="tableNameMultiple">Table Name:</label>
                <select id="tableNameMultiple" name="tableNameMultiple">
                    <option value="sale_salesinvoice">Sales Invoice</option>
                    <option value="pur_purchaseinvoice">Purchase Invoice</option>
                    <option value="pur_purchaseorder">Purchase Order</option>
                    <option value="sale_salesorder">Sales Order</option>
                </select>

                <label for="transactionNos">Transaction Nos (comma-separated):</label>
                <input type="text" id="transactionNos" name="transactionNos" required>

                <button type="button" id="generateMultipleTallyQueryButton">Generate Query</button>
				
            </div>
        </form>

        <!-- Form for Authorization Query -->
        <form id="authorizationQueryForm" action="#" method="post" style="display: none;">
            <h1>Authorization Query</h1>
            <label for="authQueryTable">Table Name:</label>
            <select id="authQueryTable" name="authQueryTable">
                <option value="sale_salesinvoice">Sales Invoice</option>
                <option value="pur_purchaseinvoice">Purchase Invoice</option>
                <option value="pur_purchaseorder">Purchase Order</option>
                <option value="sale_salesorder">Sales Order</option>
                <option value="pur_inwardchallan">Inward Challan</option>
                <option value="sale_deliverynote">Delivery Note</option>
            </select>

            <label for="authQueryNo">Transaction No:</label>
            <input type="text" id="authQueryNo" name="authQueryNo" required>

            <label for="authQueryDate">Transaction Date:</label>
            <input type="text" id="authQueryDate" name="authQueryDate" required>

            <button type="button" id="generateAuthQueryButton">Generate Query</button>
			
        </form>

        <!-- Section to display generated SQL query -->
        <div id="queryOutput"  style="display: none; margin-top: 20px;">
            <h1>Generated SQL Query</h1>
            <pre id="queryText"></pre>
        </div>
        
		</div>
		</div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwq_CDxxzVSYo7IbrgvdCacvkwi1VrQa--zHSnjbDHUdIHwJQlvK1owXdSlQj0tdT7N/exec';

	// Function to show the Save Query content
		function showSaveContent() {
			document.getElementById('savecontent').classList.add('active');
			document.getElementById('viewcontent').classList.remove('active');
			document.getElementById('backchcontent').classList.remove('active');
		}

		// Function to show the View Queries content
		function showViewContent() {
			document.getElementById('savecontent').classList.remove('active');
			document.getElementById('viewcontent').classList.add('active');
			document.getElementById('backchcontent').classList.remove('active');

			// Show loader before starting fetch
			document.getElementById('loader').style.display = 'block';

			// Hide table initially
			document.getElementById('queryTable').style.display = 'none';

			loadQueries();
		}

		// Function to show the Backend Changes content
		function showBackchContent() {
			document.getElementById('savecontent').classList.remove('active');
			document.getElementById('viewcontent').classList.remove('active');
			document.getElementById('backchcontent').classList.add('active');
		}

		// Update the button functionality for the Backch button
		document.getElementById('backchBtn').addEventListener('click', showBackchContent);

        function saveQuery() {
            const taskName = document.getElementById('taskName').value;
            const dbName = document.getElementById('dbName').value;
            const sqlQuery = document.getElementById('sqlQuery').value;
            const uploaded = document.getElementById('uploaded').checked ? 'Yes' : 'No';

            if (!taskName) {
                alert('Task Name is required. Please enter a Task Name.');
                return;
            }

            const data = { taskName, dbName, sqlQuery, uploaded };

            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify(data),
            })
                .then(response => response.json())
                .then(data => {
                    alert('Query saved successfully!');
                    document.getElementById('queryForm').reset();
                })
                .catch(error => alert('Error saving query: ' + error));
        }

        function loadQueries() {
            fetch(scriptURL)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('queryTableBody');
                    tableBody.innerHTML = '';

                    data.forEach((query, index) => {
                        const row = `
                            <tr>
                                <td>${query.taskName}</td>
                                <td>${query.dbName}</td>
                                <td>${query.sqlQuery}</td>
                                <td>${query.uploaded}</td>
                                <td>${query.date}</td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });

                    // Hide loader and display table
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('queryTable').style.display = 'table';  // Now show the table after data is loaded
                })
                .catch(error => {
                    console.error('Error loading queries:', error);
                    alert('Failed to load queries. Please try again later.');
                    document.getElementById('loader').style.display = 'none';
                });
        }
        function filterTasks() {
            const filterValue = document.getElementById('taskFilter').value.toLowerCase();

            const rows = document.querySelectorAll('#queryTableBody tr');
            rows.forEach(row => {
                const taskName = row.querySelector('td').textContent.toLowerCase();
                if (taskName.includes(filterValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
		document.getElementById('mainformbtn').addEventListener('click', function() {
			var mainForm = document.getElementById('mainForm');
			var cancelForm = document.getElementById('cancelForm');
			var tallysyncForm = document.getElementById('tallysyncForm');
			var authorizationQueryForm = document.getElementById('authorizationQueryForm');
			
			mainForm.style.display = 'block';
			cancelForm.style.display = 'none';
			tallysyncForm.style.display = 'none';
			authorizationQueryForm.style.display = 'none';
		});
		// Event listener for dropdown selection
		document.getElementById('options').addEventListener('change', function() {
			var mainForm = document.getElementById('mainForm');
			var cancelForm = document.getElementById('cancelForm');
			var tallysyncForm = document.getElementById('tallysyncForm');
			var authorizationQueryForm = document.getElementById('authorizationQueryForm');

			// Show or hide forms based on selected option
			if (this.value === 'cancel_stock_transfer') {
				mainForm.style.display = 'none';
				tallysyncForm.style.display = 'none';
				authorizationQueryForm.style.display = 'none';
				cancelForm.style.display = 'block';
			} else if (this.value === 'tallysync') {
				mainForm.style.display = 'none';
				cancelForm.style.display = 'none';
				authorizationQueryForm.style.display = 'none';
				tallysyncForm.style.display = 'block';
			} else if (this.value === 'authorization_query') {
				mainForm.style.display = 'none';
				cancelForm.style.display = 'none';
				tallysyncForm.style.display = 'none';
				authorizationQueryForm.style.display = 'block';
			} else {
				mainForm.style.display = 'block';
				cancelForm.style.display = 'none';
				tallysyncForm.style.display = 'none';
				authorizationQueryForm.style.display = 'none';
			}
		});

		// Event listener for generating SQL query for Cancel Production and Stock Transfer
		document.getElementById('generateCancelQueryButton').addEventListener('click', function() {
			var transactionType = document.getElementById('transactionType').value;
			var transactionNo = document.getElementById('transactionNo').value;
			var transactionDate = document.getElementById('transactionDate').value;
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');
			
			// Generate SQL query based on transaction type
			if (transactionType === 'production') {
				queryText.textContent = `SELECT * FROM fun_cancellproduction((SELECT productionid from prod_productionmaster where productionno='${transactionNo}' and productiondate='${transactionDate}'),'erpadmin');`;
			} else if (transactionType === 'stock') {
				queryText.textContent = `SELECT * FROM fun_cancelstockjournal_2((select adjustmentid from stor_stockadjustmentortransfer where adjustmentno = '${transactionNo}' and adjustmentdate = '${transactionDate}'),'erpadmin');`;
			}

			// Show the generated query
			queryOutput.style.display = 'block';
		});

		// Event listener for Single Transaction button in Tallysync
		document.getElementById('singleTransactionButton').addEventListener('click', function() {
			document.getElementById('singleTransactionForm').style.display = 'block';
			document.getElementById('multipleTransactionForm').style.display = 'none';
		});

		// Event listener for Multiple Transactions button in Tallysync
		document.getElementById('multipleTransactionButton').addEventListener('click', function() {
			document.getElementById('multipleTransactionForm').style.display = 'block';
			document.getElementById('singleTransactionForm').style.display = 'none';
		});

		// Event listener for generating SQL query for Single Transaction in Tallysync
		document.getElementById('generateTallyQueryButton').addEventListener('click', function() {
			var tableName = document.getElementById('tableName').value;
			var transactionNo = document.getElementById('transactionNoTally').value;
			var transactionDate = document.getElementById('transactionDateTally').value;
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');

			var query = '';
			var currentDateTime = new Date().toLocaleString();

			// Generate SQL query based on table name
			switch (tableName) {
				case 'sale_salesinvoice':
					query = `UPDATE sale_salesinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM sale_salesinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseinvoice':
					query = `UPDATE pur_purchaseinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM pur_purchaseinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseorder':
					query = `UPDATE pur_purchaseorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE poid = (SELECT poid FROM pur_purchaseorder WHERE ponumber ='${transactionNo}' AND CAST(podate as DATE) = '${transactionDate}');`;
					break;
				case 'sale_salesorder':
					query = `UPDATE sale_salesorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE soid = (SELECT soid FROM sale_salesorder WHERE sono ='${transactionNo}' AND CAST(sodate as DATE) = '${transactionDate}');`;
					break;
			}

			// Show the generated query
			queryText.textContent = query;
			queryOutput.style.display = 'block';
		});

		// Event listener for generating SQL query for Multiple Transactions in Tallysync
		document.getElementById('generateMultipleTallyQueryButton').addEventListener('click', function() {
			var tableName = document.getElementById('tableNameMultiple').value;
			var transactionNos = document.getElementById('transactionNos').value.split(',');
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');

			var query = '';
			var currentDateTime = new Date().toLocaleString();

			// Generate SQL query based on table name
			switch (tableName) {
				case 'sale_salesinvoice':
					query = `UPDATE sale_salesinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceno IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
				case 'pur_purchaseinvoice':
					query = `UPDATE pur_purchaseinvoice SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE invoiceno IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
				case 'pur_purchaseorder':
					query = `UPDATE pur_purchaseorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE ponumber IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
				case 'sale_salesorder':
					query = `UPDATE sale_salesorder SET issendtotally=False, editlog=COALESCE(editlog,'') ||'tally Sync Reset : Approved on ${currentDateTime}' WHERE sono IN (${transactionNos.map(no => `'${no.trim()}'`).join(', ')});`;
					break;
			}

			// Show the generated query
			queryText.textContent = query;
			queryOutput.style.display = 'block';
		});

		// Event listener for generating SQL query for Authorization Query
		document.getElementById('generateAuthQueryButton').addEventListener('click', function() {
			var tableName = document.getElementById('authQueryTable').value;
			var transactionNo = document.getElementById('authQueryNo').value;
			var transactionDate = document.getElementById('authQueryDate').value;
			var queryOutput = document.getElementById('queryOutput');
			var queryText = document.getElementById('queryText');

			var query = '';
			var currentDateTime = new Date().toLocaleString();

			// Generate SQL query based on table name
			switch (tableName) {
				case 'sale_salesinvoice':
					query = `UPDATE sale_salesinvoice SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM sale_salesinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseinvoice':
					query = `UPDATE pur_purchaseinvoice SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE invoiceid = (SELECT invoiceid FROM pur_purchaseinvoice WHERE invoiceno ='${transactionNo}' AND CAST(invoicedate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_purchaseorder':
					query = `UPDATE pur_purchaseorder SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE poid = (SELECT poid FROM pur_purchaseorder WHERE ponumber ='${transactionNo}' AND CAST(podate as DATE) = '${transactionDate}');`;
					break;
				case 'sale_salesorder':
					query = `UPDATE sale_salesorder SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE soid = (SELECT soid FROM sale_salesorder WHERE sono ='${transactionNo}' AND CAST(sodate as DATE) = '${transactionDate}');`;
					break;
				case 'pur_inwardchallan':
					query = `UPDATE pur_inwardchallan SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE inwardchallanid = (SELECT inwardchallanid FROM pur_inwardchallan WHERE inwardchallanno ='${transactionNo}' AND CAST(inwardchallandate as DATE) = '${transactionDate}');`;
					break;
				case 'sale_deliverynote':
					query = `UPDATE sale_deliverynote SET authorizedby=NULL, isauthorized=FALSE, editlog=COALESCE(editlog,'') ||'unauthorized : Approved on ${currentDateTime}' WHERE deliverynoteid = (SELECT deliverynoteid FROM sale_deliverynote WHERE deliverynoteno ='${transactionNo}' AND CAST(deliverynotedate as DATE) = '${transactionDate}');`;
					break;
			}

			// Show the generated query
			queryText.textContent = query;
			queryOutput.style.display = 'block';
		});
        window.onload = showSaveContent;
    </script>
</body>
</html>
